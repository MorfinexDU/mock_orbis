1 DESCRIÇÃO
A tabela “parametros_processo” armazena todos os parâmetros de processo que podem ser utilizados nos cálculos de TPE (Tempo Padrão de Engenharia).
Esses parâmetros são campos dinâmicos que o usuário preenche ao realizar um cálculo (ex.: perímetro, área de superfície, espessura, quantidade de furos, etc.).
* Define quais parâmetros estão disponíveis para o cálculo
* Armazena tipo de dado, unidade de medida e validações
* Permite criar campos customizados sem alterar código
* Controla ordem de exibição e obrigatoriedade

2 OBJETIVO
* Centralizar a definição de parâmetros de processo em uma única tabela configurável;
* Padronizar tipos de dados e unidades de medida;
* Permitir configuração sem necessidade de alteração de código (campos dinâmicos);
* Validar entradas do usuário com base em tipo e obrigatoriedade;
* Integrar com fórmulas de cálculo que referenciam esses parâmetros.
3 LÓGICA TÉCNICA DE AQUISIÇÃO DE DADOS
Fontes
* Interface administrativa do widget (criação/edição de parâmetros);
* Chamadas de API diretamente (criação/edição de parâmetros).
Script para criar tabela
CREATE TABLE parametros_processo (
    id INT IDENTITY(1,1) PRIMARY KEY,
    nome NVARCHAR(100) NOT NULL UNIQUE,
    tipo NVARCHAR(50) NOT NULL,
    unidade NVARCHAR(20),
    descricao NVARCHAR(500),
    opcoes NVARCHAR(MAX), --json
    valor_padrao NVARCHAR(200),
    obrigatorio BIT DEFAULT 0,
    imagem_base64 NVARCHAR(MAX),
    data_criacao DATETIME2 DEFAULT GETDATE()
);

-- Índices para performance
CREATE INDEX idx_parametros_nome ON parametros_processo(nome);
CREATE INDEX idx_parametros_tipo ON parametros_processo(tipo);
CREATE INDEX idx_parametros_obrigatorio ON parametros_processo(obrigatorio);

-- Constraint para validar JSON no campo opcoes (quando aplicável)
ALTER TABLE parametros_processo
ADD CONSTRAINT chk_parametros_opcoes_json 
CHECK (opcoes IS NULL OR ISJSON(opcoes) = 1);

4 FILTROS
Recomendações de filtros no consumo (API/relatórios/SQL):
* Por nome
* Por tipo
* Por descrição
* Busca textual em nome e descrição

5 RECORRÊNCIA DE ATUALIZAÇÃO
* Widget/API ? atualização em tempo real (transacional).
6 CAMPO CHAVE PARA ATUALIZAÇÃO
Chave primária: `id` (INT IDENTITY)

Chave natural (UNIQUE): `nome` - garante que não existam parâmetros com nomes duplicados

Estratégia de operações:
CREATE (POST)
- Valida se `nome` já existe (UNIQUE constraint)
- Insere novo registro com ID auto-gerado

UPDATE (PUT)
- Identificação por `id` enviado na URL (`/orbis/parametros/:id`)
- Atualiza campos enviados no body
- Valida unicidade de `nome` se este campo for alterado

DELETE (DELETE)
- Quando usuário excluir via widget: `DELETE FROM parametros_processo WHERE id = @id`
- Remove permanentemente o registro do banco
- Usado quando o parâmetro foi criado por engano ou não é mais necessário


1. API – DADOS DE ENTRADA


POST "/orbis/parametros" - Criar novo parâmetro (tipo numérico)
* Descrição: Cria um parâmetro de processo no sistema.
* Body (JSON):
{
  "nome": "quantidade_dobras",
  "tipo": "numero_decimal",
  "unidade": "unidade",
  "descricao": "Quantidade de dobras na peça",
  "opcoes": null,
  "valor_padrao": "0",
  "obrigatorio": 1,
  "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..."
}
* Retorno 201:
{
  "success": true,
  "data": {
    "id": 15,
    "nome": "quantidade_dobras",
    "tipo": "numero_decimal",
    "unidade": "unidade",
    "descricao": "Quantidade de dobras na peça",
    "opcoes": null,
    "valor_padrao": "0",
    "obrigatorio": 1,
    "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..."
    "data_criacao": "2025-10-09T14:30:00Z"
  }
}

POST "/orbis/parametros" - Criar novo parâmetro (tipo select com opções)
* Descrição: Cria um parâmetro de processo no sistema.
* Body (JSON):
{
  "nome": "maquina_dobradeira",
  "tipo": "select",
  "unidade": null,
  "descricao": "Tipo de máquina dobradeira",
  "opcoes": [
    "DOBRADEIRA PARA CHAPA FINA AÇO(< 3mm)",
    "DOBRADEIRA PARA CHAPAS DE ALUMÍNIO",
    "DOBRADEIRA AUTOMATIZADA",
    "DOBRADEIRA P/ CHAPA GROSSA DE AÇO(>=3mm)",
    "DOBRADEIRA PARA CHAPAS PAVILHAO POLTRO"
  ],
  "valor_padrao": "DOBRADEIRA AUTOMATIZADA",
  "obrigatorio": 1,
  "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..."
}
* Retorno 201:
{
  "success": true,
  "data": {
    "id": 16,
    "nome": "maquina_dobradeira",
    "tipo": "select",
    "unidade": null,
    "descricao": "Tipo de máquina dobradeira",
    "opcoes": [
      "DOBRADEIRA PARA CHAPA FINA AÇO(< 3mm)",
      "DOBRADEIRA PARA CHAPAS DE ALUMÍNIO",
      "DOBRADEIRA AUTOMATIZADA",
      "DOBRADEIRA P/ CHAPA GROSSA DE AÇO(>=3mm)",
      "DOBRADEIRA PARA CHAPAS PAVILHAO POLTRO"
    ],
    "valor_padrao": "DOBRADEIRA AUTOMATIZADA",
    "obrigatorio": 1,
    "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA...",
    "data_criacao": "2025-10-09T14:30:00Z"
  }
}

PUT "/orbis/parametros/:id" - Atualizar parâmetro existente
* Descrição: Atualiza dados de um parâmetro existente identificado pelo ID
* URL Parameter: "id" (obrigatório)
* Body (JSON):
{
  "nome": "quantidade_dobras",
  "tipo": "numero_decimal",
  "unidade": "unidade",
  "descricao": "Quantidade de dobras na peça (atualizado)",
  "opcoes": null,
  "valor_padrao": "0",
  "obrigatorio": 1,
  "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA..."
}
* Retorno 200:
        {
          "success": true,
          "data": {
            "id": 15,
            "nome": "quantidade_dobras",
            "tipo": "numero_decimal",
            "unidade": "unidade",
            "descricao": "Quantidade de dobras na peça (atualizado)",
            "opcoes": null,
            "valor_padrao": "0",
            "obrigatorio": 1,
            "imagem_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA...",
            "data_criacao": "2025-10-07T14:30:00Z"
          }
        }
* Retorno 404: "{"success": false, "error": "Parâmetro não encontrado"}"
* Retorno 409: "{"success": false, "error": "Já existe um parâmetro com este nome"}"

DELETE "/orbis/parametros/:id" - Excluir parâmetro permanentemente
* Descrição: DELETE físico - remove registro do banco definitivamente
* URL Parameter: "id" (obrigatório)
* Retorno 200:
{
  "success": true,
  "message": "Parâmetro excluído permanentemente"
}

* Retorno 404: “{“success": false, "error": "Parâmetro não encontrado”}"

7 API – DADOS DE SAÍDA

GET “/orbis/parametros” – Listar parâmetros
* Descrição: Retorna lista de todos os parâmetros (com filtros opcionais de [nome, tipo, ativo, descrição])
* Parâmetros: filtros opcionais
* Retorno: coleção de parametros.

GET “/orbis/parâmetros/:id” – Buscar parâmetro por ID
* Descrição: Retorna um parâmetro específico pelo ID
* Retorno 200: Objeto único do parâmetro
* Retorno 404: “{"success": false, "error": "Parâmetro não encontrado"}”
GET “/orbis/parametros/nome/:nome” – Buscar parâmetro por nome
* Descrição: Retorna um parâmetro específico pelo nome
* Retorno 200: Objeto único do parâmetro
* Retorno 404: “{"success": false, "error": "Parâmetro não encontrado"}”

2. CATEGORIZAÇÃO DO DHIVE


3. ÁREAS IMPACTADAS PELA INFORMAÇÃO
Engenharia de Processos

4. VALOR AGREGADO PARA A COMPANHIA
* Padronização: Unifica definição de parâmetros de processo em toda a empresa
* Flexibilidade: Permite criar parâmetros sem alteração de código
* Rastreabilidade: Histórico completo de alterações via auditoria
* Integração: Base para cálculos automatizados de TPE
* Qualidade: Validações impedem erros de entrada de dados
* Migração para 3DEXPERIENCE: Remove dependência de planilhas Excel e sistemas legados
5. INTEGRAÇÃO COM SISTEMA DE AUDITORIA
Todas as operações de CREATE, UPDATE, DELETE, ACTIVATE e DEACTIVATE nesta tabela DEVEM registrar logs na tabela "logs_auditoria".

1. RECEBER user_id no Body
   Todas as requisições POST, PUT, PATCH e DELETE devem receber o campo user_id:
   Body exemplo:
           {
             "nome": "...",
             "descricao": "...",
             "user_id": "eduardo.silva"  ? OBRIGATÓRIO
           }
2. CHAMAR Função de Log
   Após cada operação bem-sucedida, chamar:
           registrarLog(
             tabela: 'nome_da_tabela',
             registro_id: id_do_registro,
             operacao: 'CREATE' | 'UPDATE' | 'DELETE' | 'ACTIVATE' | 'DEACTIVATE',
             valores_anteriores: objeto_com_valores_antigos (NULL para CREATE),
             valores_novos: objeto_com_valores_novos (NULL para DELETE),
             user_id: user_id_recebido_no_body
           );
3. EXEMPLOS POR OPERAÇÃO
   CREATE (POST):
* Capturar user_id do body
* Executar INSERT na tabela
* Chamar: registrarLog('tabela', novo_id, 'CREATE', null, dados_inseridos, user_id)
   UPDATE (PUT):
*    Capturar user_id do body
*    Buscar valores anteriores: SELECT * FROM tabela WHERE id = @id
*    Executar UPDATE na tabela
*    Buscar valores novos: SELECT * FROM tabela WHERE id = @id
*    Chamar: registrarLog('tabela', id, 'UPDATE', valores_anteriores, valores_novos, user_id)
   DELETE (DELETE):
*    Capturar user_id do body
*    Buscar valores anteriores: SELECT * FROM tabela WHERE id = @id
*    Executar DELETE na tabela
*    Chamar: registrarLog('tabela', id, 'DELETE', valores_anteriores, null, user_id)
   ACTIVATE (PATCH /:id/ativar):
*    Capturar user_id do body
*    Buscar valor anterior: SELECT ativo FROM tabela WHERE id = @id
*    Executar: UPDATE tabela SET ativo = 1 WHERE id = @id
*    Chamar: registrarLog('tabela', id, 'ACTIVATE', {ativo: 0}, {ativo: 1}, user_id)
   DEACTIVATE (PATCH /:id/desativar):
*    Capturar user_id do body
*    Buscar valor anterior: SELECT ativo FROM tabela WHERE id = @id
*    Executar: UPDATE tabela SET ativo = 0 WHERE id = @id
*    Chamar: registrarLog('tabela', id, 'DEACTIVATE', {ativo: 1}, {ativo: 0}, user_id)
Elaboração de API


		

        DAPI - Document Application Programming Interface

		


